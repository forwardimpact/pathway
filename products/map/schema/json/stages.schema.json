{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://www.forwardimpact.team/schema/json/stages.schema.json",
  "title": "Stages",
  "description": "Engineering lifecycle stages with their tools, handoffs, and constraints",
  "type": "array",
  "items": {
    "$ref": "#/$defs/stage"
  },
  "$defs": {
    "stage": {
      "type": "object",
      "required": ["id", "name"],
      "properties": {
        "id": {
          "type": "string",
          "enum": ["specify", "plan", "onboard", "code", "review", "deploy"],
          "description": "Stage identifier"
        },
        "name": {
          "type": "string",
          "description": "Human-readable stage name"
        },
        "emojiIcon": {
          "type": "string",
          "description": "Emoji for visual representation"
        },
        "description": {
          "type": "string",
          "description": "Description of the stage's purpose (second-person, for agent body)"
        },
        "summary": {
          "type": "string",
          "description": "Third-person summary for metadata, listings, and sub-agent descriptions"
        },
        "handoffs": {
          "type": "array",
          "description": "Transitions to other stages",
          "items": {
            "$ref": "#/$defs/handoff"
          }
        },
        "constraints": {
          "type": "array",
          "description": "Restrictions on behaviour in this stage",
          "items": {
            "type": "string"
          }
        },
        "readChecklist": {
          "type": "array",
          "description": "Read-Then-Do Checklist: steps to follow in order during this stage",
          "items": {
            "type": "string"
          }
        },
        "confirmChecklist": {
          "type": "array",
          "description": "Do-Then-Confirm Checklist: items to verify before handing off to next stage",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false
    },
    "handoff": {
      "type": "object",
      "required": ["targetStage", "label", "prompt"],
      "properties": {
        "targetStage": {
          "type": "string",
          "enum": ["specify", "plan", "onboard", "code", "review", "deploy"],
          "description": "The stage to transition to"
        },
        "label": {
          "type": "string",
          "description": "Button label for the handoff action"
        },
        "prompt": {
          "type": "string",
          "description": "Instructions for the next stage"
        }
      },
      "additionalProperties": false
    }
  }
}
