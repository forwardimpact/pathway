{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://www.forwardimpact.team/schema/json/capability.schema.json",
  "title": "Capability",
  "description": "Capability area that groups related skills with responsibilities and checklists",
  "type": "object",
  "required": ["name"],
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^[a-z][a-z0-9_]*$",
      "description": "Capability identifier (derived from filename if not specified)"
    },
    "name": {
      "type": "string",
      "description": "Human-readable capability name"
    },
    "emojiIcon": {
      "type": "string",
      "description": "Emoji for visual representation"
    },
    "ordinalRank": {
      "type": "integer",
      "minimum": 1,
      "description": "Numeric rank for ordering capabilities (1 = first)"
    },
    "description": {
      "type": "string",
      "description": "Description of the capability area"
    },
    "professionalResponsibilities": {
      "$ref": "#/$defs/responsibilitiesByLevel",
      "description": "Responsibilities for professional/IC track by level"
    },
    "managementResponsibilities": {
      "$ref": "#/$defs/responsibilitiesByLevel",
      "description": "Responsibilities for management track by level"
    },
    "skills": {
      "type": "array",
      "description": "Skills within this capability",
      "items": {
        "$ref": "#/$defs/skill"
      }
    }
  },
  "additionalProperties": false,
  "$defs": {
    "responsibilitiesByLevel": {
      "type": "object",
      "properties": {
        "awareness": { "type": "string" },
        "foundational": { "type": "string" },
        "working": { "type": "string" },
        "practitioner": { "type": "string" },
        "expert": { "type": "string" }
      },
      "required": [
        "awareness",
        "foundational",
        "working",
        "practitioner",
        "expert"
      ],
      "additionalProperties": false
    },
    "skill": {
      "type": "object",
      "required": ["id", "name", "human"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9_]*$",
          "description": "Unique skill identifier (snake_case)"
        },
        "name": {
          "type": "string",
          "description": "Human-readable skill name"
        },
        "isHumanOnly": {
          "type": "boolean",
          "description": "If true, this skill is excluded from agent profiles"
        },
        "human": {
          "$ref": "#/$defs/skillHumanSection",
          "description": "Human-specific content for the skill"
        },
        "agent": {
          "$ref": "#/$defs/skillAgentSection",
          "description": "Agent-specific content for the skill"
        },
        "toolReferences": {
          "type": "array",
          "description": "Required tools for this skill",
          "items": { "$ref": "#/$defs/toolReference" }
        },
        "instructions": {
          "type": "string",
          "description": "Step-by-step workflow guidance for the main SKILL.md body"
        },
        "installScript": {
          "type": "string",
          "description": "Shell commands for environment setup, exported to scripts/install.sh"
        },
        "implementationReference": {
          "type": "string",
          "description": "Code examples and detailed reference material, exported to references/REFERENCE.md"
        }
      },
      "additionalProperties": false
    },
    "toolReference": {
      "type": "object",
      "required": ["name", "description", "useWhen"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Tool name"
        },
        "url": {
          "type": "string",
          "format": "uri",
          "description": "Link to tool documentation"
        },
        "simpleIcon": {
          "type": "string",
          "pattern": "^[a-z0-9]+$",
          "description": "Simple Icons slug for the tool icon (e.g., 'terraform', 'docker')"
        },
        "description": {
          "type": "string",
          "description": "What this tool does"
        },
        "useWhen": {
          "type": "string",
          "description": "When to use this tool"
        }
      },
      "additionalProperties": false
    },
    "skillHumanSection": {
      "type": "object",
      "required": ["description", "levelDescriptions"],
      "properties": {
        "description": {
          "type": "string",
          "description": "Description of the skill"
        },
        "levelDescriptions": {
          "$ref": "#/$defs/levelDescriptions",
          "description": "Description of expectations at each level"
        }
      },
      "additionalProperties": false
    },
    "levelDescriptions": {
      "type": "object",
      "properties": {
        "awareness": { "type": "string" },
        "foundational": { "type": "string" },
        "working": { "type": "string" },
        "practitioner": { "type": "string" },
        "expert": { "type": "string" }
      },
      "required": [
        "awareness",
        "foundational",
        "working",
        "practitioner",
        "expert"
      ],
      "additionalProperties": false
    },
    "skillAgentSection": {
      "type": "object",
      "required": ["name", "description", "useWhen", "stages"],
      "properties": {
        "name": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*$",
          "description": "Agent skill name (kebab-case)"
        },
        "description": {
          "type": "string",
          "description": "Brief description of what this skill provides"
        },
        "useWhen": {
          "type": "string",
          "description": "Triggering conditions - when agents should use this skill"
        },
        "stages": {
          "type": "object",
          "description": "Stage-specific guidance for applying the skill",
          "properties": {
            "specify": { "$ref": "#/$defs/skillStage" },
            "plan": { "$ref": "#/$defs/skillStage" },
            "onboard": { "$ref": "#/$defs/skillStage" },
            "code": { "$ref": "#/$defs/skillStage" },
            "review": { "$ref": "#/$defs/skillStage" },
            "deploy": { "$ref": "#/$defs/skillStage" }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "skillStage": {
      "type": "object",
      "required": ["focus", "readChecklist", "confirmChecklist"],
      "properties": {
        "focus": {
          "type": "string",
          "description": "Primary focus for this stage"
        },
        "readChecklist": {
          "type": "array",
          "description": "Read-Then-Do Checklist: steps to follow in order during this stage",
          "items": { "type": "string" }
        },
        "confirmChecklist": {
          "type": "array",
          "description": "Do-Then-Confirm Checklist: items to verify before moving to next stage",
          "items": { "type": "string" }
        }
      },
      "additionalProperties": false
    }
  }
}
