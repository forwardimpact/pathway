{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://schema.forwardimpact.team/json/stages.schema.json",
  "title": "Stages",
  "description": "Engineering lifecycle stages with their tools, handoffs, and constraints",
  "type": "array",
  "items": {
    "$ref": "#/$defs/stage"
  },
  "$defs": {
    "stage": {
      "type": "object",
      "required": ["id", "name"],
      "properties": {
        "id": {
          "type": "string",
          "enum": ["specify", "plan", "code", "review"],
          "description": "Stage identifier"
        },
        "name": {
          "type": "string",
          "description": "Human-readable stage name"
        },
        "emoji": {
          "type": "string",
          "description": "Emoji for visual representation"
        },
        "description": {
          "type": "string",
          "description": "Description of the stage's purpose"
        },
        "handoffs": {
          "type": "array",
          "description": "Transitions to other stages",
          "items": {
            "$ref": "#/$defs/handoff"
          }
        },
        "constraints": {
          "type": "array",
          "description": "Restrictions on behaviour in this stage",
          "items": {
            "type": "string"
          }
        },
        "entryCriteria": {
          "type": "array",
          "description": "Conditions that must be met before entering this stage",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false
    },
    "handoff": {
      "type": "object",
      "required": ["targetStage", "label", "prompt"],
      "properties": {
        "targetStage": {
          "type": "string",
          "enum": ["specify", "plan", "code", "review"],
          "description": "The stage to transition to"
        },
        "label": {
          "type": "string",
          "description": "Button label for the handoff action"
        },
        "prompt": {
          "type": "string",
          "description": "Instructions for the next stage"
        }
      },
      "additionalProperties": false
    }
  }
}
